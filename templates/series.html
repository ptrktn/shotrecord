{% extends "base.html" %}

{% block title %}Series{% endblock %}

{% block xhead %}

<style>
  .table-hover tbody tr:hover {
    cursor: pointer; /* show pointer cursor */
  }
</style>

{% endblock %}

{% block content %}

<div class="container">

  <table id="series" class="table table-hover">
    <thead>
      <tr>
        <th>Date</th>
        <th>Description</th>
        <th>Points</th>
        <th>Time</th>
      </tr>
    </thead>
    <tbody id="data-table-body">
      <!-- Data will be loaded here -->
    </tbody>
  </table>

  <nav aria-label="Page navigation example">
    <ul class="pagination" id="pagination-controls">
      <!-- Pagination links will be generated here -->
    </ul>
  </nav>

</div> <!-- container -->

<script>
  let allData = [];
  const itemsPerPage = 100;

  async function fetchData(pageNumber, itemsPerPage) {
    try {
      const response = await fetch(`/data/series?page=${pageNumber}&limit=${itemsPerPage}`);
      const data = await response.json();
      populateTable(data.items); // Assuming 'items' is the array of data
      generatePagination(data.totalItems, pageNumber, itemsPerPage); // Assuming 'totalItems' is the total count
    } catch (error) {
      console.error('Error fetching data:', error);
    }
  }

  function populateTable(items) {
    const tableBody = document.getElementById('data-table-body');
    tableBody.innerHTML = ''; // Clear existing data
    items.forEach(item => {
      const row = tableBody.insertRow();
      row.setAttribute('data-row-id', item.id);
      row.insertCell().textContent = item.created_at;
      row.insertCell().textContent = item.description;
      row.insertCell().textContent = item.total_points;
      row.insertCell().textContent = item.total_t;
    });
  }

  function generatePagination(totalItems, currentPage, itemsPerPage) {
    const paginationControls = document.getElementById('pagination-controls');
    paginationControls.innerHTML = ''; // Clear existing controls
    const totalPages = Math.ceil(totalItems / itemsPerPage);

    for (let i = 1; i <= totalPages; i++) {
      const li = document.createElement('li');
      li.classList.add('page-item');
      if (i === currentPage) {
        li.classList.add('active');
      }
      const a = document.createElement('a');
      a.classList.add('page-link');
      a.textContent = i;
      a.href = '#'; // Prevent full page reload
      a.addEventListener('click', (event) => {
        event.preventDefault();
        fetchData(i, itemsPerPage);
      });
      li.appendChild(a);
      paginationControls.appendChild(li);
    }
  }

  document.getElementById('series').addEventListener('click', function (event) {
    const row = event.target.closest('tr');
    if (row) {
      const id = row.getAttribute('data-row-id');
      const url = `/target/${id}`;
      // Redirect the user
      window.location.href = url;
    }
  });

  // Initial load
  document.addEventListener('DOMContentLoaded', () => {
    fetchData(1, itemsPerPage); // Load the first page
  });
</script>

{% endblock %}
